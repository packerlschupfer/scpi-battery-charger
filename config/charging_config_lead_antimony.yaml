# Battery Charger Configuration - LEAD-ANTIMONY BATTERIES (Legacy, Pre-2010)
# OWON SPE6205 (60V 20A Power Supply)
#
# IMPORTANT: This configuration is for OLD lead-antimony batteries!
# These batteries were standard BEFORE ~2010.
# Modern batteries since 2010 are lead-calcium and need DIFFERENT voltages!
#
# Use this configuration ONLY if you have:
#   - Battery manufactured BEFORE 2010
#   - Battery with removable caps (serviceable)
#   - Battery requiring regular water top-up
#   - Label says "Sb" (antimony) or no calcium marking
#
# If your battery is from 2010 or later, use:
#   charging_config_lead_calcium.yaml instead!
#
# Source: https://wiki.w311.info/index.php?title=Batterie_Heute

# Power Supply Configuration
power_supply:
  model: "OWON SPE6205"
  port: "/dev/ttyUSB0"           # USB serial port
  baudrate: 115200                # OWON uses 115200
  timeout: 5.0                    # Serial timeout (seconds)

  # Hardware limits (SPE6205 specifications)
  max_voltage: 60.0               # V - Hardware maximum (0.01-60V range)
  max_current: 20.0               # A - Hardware maximum (0.001-20A range)

# Battery Specifications
battery:
  type: "lead_antimony_flooded"   # Legacy lead-antimony battery
  nominal_voltage: 12.0           # V
  capacity: 95.0                  # Ah
  chemistry: "lead_antimony"      # Sb electrodes
  manufacture_year: 2005          # Approximate (adjust to your battery)

# Charging Configuration
charging:
  # Default charging mode: IUoU, CV, Pulse, Trickle
  default_mode: "IUoU"

  # IUoU (3-Stage) Mode Configuration - LEAD-ANTIMONY OPTIMIZED
  IUoU:
    bulk_current: 9.5             # A - 0.1C for 95Ah (C/10 rate, good balance)
                                   # SPE6205 can deliver up to 20A
                                   # Use 4.75A for slower/gentler charge

    # Lead-antimony uses LOWER voltages than lead-calcium
    absorption_voltage: 14.4      # V - Proper voltage for lead-antimony
                                   # (vs 15.2V for lead-calcium!)

    float_voltage: 13.6           # V - Maintenance voltage for lead-antimony
                                   # (vs 13.8V for lead-calcium)

    absorption_current_threshold: 1.0  # A - Switch to float when current drops below this
    absorption_timeout: 7200      # seconds (2 hours max in absorption)
    enable_float: true            # Enable float stage

  # Constant Voltage Mode Configuration - LEAD-ANTIMONY
  CV:
    voltage: 13.8                 # V - Proper CV voltage for lead-antimony
                                   # (vs 15.0V for lead-calcium!)
    max_current: 9.5              # A - Current limit (C/10 rate)
    min_current: 0.5              # A - Consider charged when below this

  # Pulse Charging Mode Configuration (Desulfation)
  # Lead-antimony has LOWER gassing voltage (14.8V vs 15.8V)
  # Must be more conservative with pulse voltage
  Pulse:
    pulse_voltage: 15.5           # V - Pulse voltage for lead-antimony
                                   # Note: Gassing voltage is 14.8V for lead-antimony
                                   # Pulses will cause gassing (ventilation required!)
    pulse_current: 9.5            # A - Pulse current (C/10 rate)
                                   # SPE6205 can deliver up to 20A
    rest_voltage: 13.0            # V - Rest voltage
    pulse_duration: 30            # seconds
    rest_duration: 30             # seconds
    max_cycles: 20                # Pulse cycles

  # Trickle Charge Mode Configuration
  Trickle:
    voltage: 13.5                 # V - Maintenance voltage for lead-antimony
    current: 0.5                  # A - Very low current

# Safety Limits (Apply to all modes)
safety:
  # Absolute maximum limits
  # Lead-antimony charging end voltage is 16V (per German wiki)
  absolute_max_voltage: 16.0      # V - Safe maximum for lead-antimony
                                   # (vs 16.5V for lead-calcium)
  absolute_max_current: 20.0      # A - Hardware limit (SPE6205: 0.001-20A)

  # Operational limits
  min_voltage: 10.5               # V - Minimum safe voltage
  warning_voltage: 12.5           # V - ⚠️  RECHARGE IMMEDIATELY below this!
                                   # Per German technical guide: 12.5V = 80% SOC
                                   # Risk of permanent damage if discharged further

  max_charging_duration: 43200    # seconds (12 hours)

  # Temperature limits (if sensor available)
  max_temperature: 45.0           # °C - Stop if too hot
  min_temperature: 0.0            # °C - Don't charge if too cold

  # Monitoring intervals
  measurement_interval: 5.0       # seconds - How often to measure
  log_interval: 60.0              # seconds - How often to log to file

# Temperature Sensor Configuration (Optional)
temperature:
  enabled: false                  # Set to true to enable temperature monitoring
  sensor_type: "ds18b20"          # Sensor type (ds18b20 or none)
  sensor_id: null                 # DS18B20 sensor ID (null = auto-detect)
                                   # Example: "28-0123456789ab"
                                   # Setup: sudo raspi-config → Interface Options → 1-Wire

# MQTT Configuration
mqtt:
  enabled: true                   # Enable MQTT monitoring/control
  broker: "localhost"             # MQTT broker address
  port: 1883                      # MQTT broker port
  username: ""                    # MQTT username (empty if no auth)
  password: ""                    # MQTT password (empty if no auth)
  client_id: "battery-charger"    # MQTT client ID
  base_topic: "battery-charger"   # Base topic for all messages
  qos: 1                          # Quality of Service (0, 1, or 2)
  retain: true                    # Retain status messages
  update_interval: 5.0            # seconds - How often to publish status

  # Last Will and Testament (LWT) for offline detection
  lwt_topic: "battery-charger/status/online"
  lwt_payload: "false"

# Logging Configuration
logging:
  enabled: true                   # Enable data logging
  log_dir: "logs"                 # Log directory (relative to project root)
  format: "csv"                   # csv or json
  max_files: 30                   # Keep last 30 log files

  # Fields to log
  fields:
    - timestamp
    - voltage_measured
    - current_measured
    - voltage_setpoint
    - current_setpoint
    - charging_mode
    - charging_state
    - charging_stage
    - elapsed_time
    - progress_percent

# Notifications (future feature)
notifications:
  # Email notifications
  email_enabled: false
  email_to: ""
  email_from: ""

  # Console notifications
  console_enabled: true

  # Events to notify
  notify_on_start: true
  notify_on_complete: true
  notify_on_error: true
  notify_on_safety_limit: true

# NOTES FOR LEAD-ANTIMONY BATTERIES:
#
# Characteristics:
# - Higher self-discharge (needs recharging every 3 months)
# - Water consumption (needs regular topping up)
# - Gassing starts at 14.8V
# - Serviceable (removable caps)
# - Common before 2010
#
# Advantages:
# - More tolerant of deep discharge
# - Better for high-current applications
# - Easier to recondition
#
# Disadvantages:
# - Requires maintenance (water top-up)
# - Higher self-discharge
# - Shorter storage time without recharge
